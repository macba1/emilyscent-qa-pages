<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EmilyScent QA Pages</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Fuente y estilos básicos -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin:0;
      padding:2rem;
      font-family:'Inter',sans-serif;
      background:#f3e8df;
      color:#2C1D13;
    }
    a { color:#e74266; text-decoration:none; }
    a:hover { text-decoration:underline; }
    h1, h2 { margin-top:0; }
    .container {
      background:#fff;
      padding:2rem;
      border-radius:16px;
      max-width:800px;
      margin:2rem auto;
      box-shadow:0 10px 24px rgba(0,0,0,0.1);
    }
    #slugList ul { list-style:none; padding:0; }
    #slugList li { margin:0.5rem 0; }
    #slugList a { font-weight:600; }
    .not-found { text-align:center; margin-top:4rem; font-style:italic; }
  </style>
</head>
<body>

  <div id="app" class="container">
    <!-- Aquí se inyecta todo vía JS -->
    <h2>Loading…</h2>
  </div>

  <script>
    (async () => {
      const sheetId = '1mXAJjrOK7IeLegcu5M3g1Qbyeu7W3okvnhHEFFVmuF4';
      const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?gid=0&tqx=out:json`;

      // 1) Descarga y limpia el callback de Google
      const raw      = await fetch(url).then(r => r.text());
      const json     = JSON.parse(raw.replace(/^[^\(]*\(|\);?$/g, ''));

      // 2) Extrae filas y usa la fila 1 como cabecera
      const rows     = json.table.rows;
      const header   = rows[0].c.map(c => c && c.v ? c.v : '');
      const dataRows = rows.slice(1).map(r => {
        const obj = {};
        r.c.forEach((cell,i) => {
          obj[ header[i] ] = cell && cell.v ? cell.v : '';
        });
        return obj;
      });

      // 3) Colecta todos los slugs no vacíos
      const slugs = dataRows
        .map(o => o['Slug'])
        .filter(s => typeof s === 'string' && s.trim());

      // 4) Determina la “ruta” solicitada
      const path = window.location.pathname
        .replace(/^\/|\/$/g, '');

      const app = document.getElementById('app');
      app.innerHTML = ''; // limpia “Loading…”

      if (!path) {
        // --- raíz: lista de slugs ---
        const title = document.createElement('h2');
        title.textContent = 'Debug: Available slugs';
        app.appendChild(title);

        if (!slugs.length) {
          app.innerHTML += '<p><em>No slugs found in your sheet.</em></p>';
        } else {
          const list = document.createElement('ul');
          slugs.forEach(s => {
            const li = document.createElement('li');
            li.innerHTML = `<a href="./${s}">${s}</a>`;
            list.appendChild(li);
          });
          app.appendChild(list);
        }

      } else {
        // --- ruta con slug: busca y renderiza QA ---
        const item = dataRows.find(o => o['Slug'] === path);

        if (!item) {
          app.innerHTML = `
            <h2 class="not-found">Page not found</h2>
            <p class="not-found">No entry for “${path}”.</p>
          `;
        } else {
          // pon aquí los nombres exactos de columnas de tu hoja
          const question  = item['SEO Question'];
          const answer    = item['Sarcastic Answer'];
          const perfume   = item['Perfume Name'];
          const link      = item['Amazon Affiliate'];

          app.innerHTML = `
            <h1>${question}</h1>
            <p>${answer}</p>
            <p><strong>Perfume:</strong> ${perfume}</p>
            <p><a href="${link}" target="_blank">Buy on Amazon</a></p>
          `;
        }
      }
    })();
  </script>
</body>
</html>
